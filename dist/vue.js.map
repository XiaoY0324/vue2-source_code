{"version":3,"file":"vue.js","sources":["../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/observer/dep.js","../src/utils.js","../src/observer/scheduler.js","../src/observer/watcher.js","../src/vdom/patch.js","../src/lifecycle.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/initMixin.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配双花括号 {{}}\n\n// 数组转对象 [{ name: 'aaa', value: 'bbb' }] => { aaa: 'bbb' }\nfunction genProps(attrs) {\n  let str = '';\n\n  for (let i = 0; i < attrs.length; i++) {\n    let attr = attrs[i];\n\n    if (attr.name === 'style') { // style: \"color: red; background: blue;\"\n      let styleObj = {};\n\n      attr.value.replace(/([^;:]+)\\:([^;:]+)/g, function() {\n        styleObj[arguments[1]] = arguments[2];\n      });\n\n      attr.value = styleObj;\n    }\n\n    str += `${ attr.name }: ${ JSON.stringify(attr.value) },`\n  }\n\n  return `{${ str.slice(0, -1) }}` // 删掉多余的逗号\n}\n\n// 检查子节点 递归生成 code\nfunction gen(node) {\n  if (node.type == 1) {\n    // 节点类型\n    return generate(node);\n  } else {\n    let text = node.text;\n\n    if (!defaultTagRE.test(text)) {\n      // 文本内容不包含双花括号\n      return `_v(\"${ text }\")`;\n    } else {\n      // 双花括号内的当做变量进行拼接 -> hello {{ msg }} 你好呀\n      let tokens = [];\n      let match;\n      // {{}} 结束索引 也是下一次遍历的开始索引 \n      // defaultTagRE.lastIndex 也重置为 0，因为正则全局匹配和 exec 有冲突\n      // 每次匹配完要重置下标\n      let lastIdx = defaultTagRE.lastIndex = 0; \n\n      while(match = defaultTagRE.exec(text)) {\n        // 匹配到了 {{}}\n        let startIdx = match.index; // 开始索引\n\n        if (startIdx > lastIdx) {\n          tokens.push(JSON.stringify(text.slice(lastIdx, startIdx)));\n        }\n\n        // 花括号内变量 考虑换行需要 trim\n        // 花括号内可能是个对象，为了避免隐式转为 [object Object]\n        // 使用 _s 包装，_s 其实就是调用了 JSON.stringify()\n        tokens.push(`_s(${ match[1].trim() })`);\n        \n        lastIdx = startIdx + match[0].length; // 结束索引\n      }\n\n      // 截取最好一段 比如 \"hello {{ msg }} 你好呀\" 中的 \"你好呀\"\n      if (lastIdx < text.length) {\n        tokens.push(JSON.stringify(text.slice(lastIdx)));\n      }\n\n      return `_v(${ tokens.join('+') })`;\n    }\n  }\n}\n\n// 获取 ast 节点的儿子\nfunction genChildren(node) {\n  let children = node.children; // 获取儿子\n\n  if (children) {\n    // 递归拼接\n    return children.map(c => gen(c)).join(',');\n  }\n\n  return false;\n}\n\n\n// 生成类似 _c('div', { id: 'app', a: 1 }, _v('hello')) 这样的代码片段 也有可能是下面这种哦\n// _c('div', { id: 'app', a: 1 }, _c('span', { id: 'span'}, _v('套娃子节点')))\n// _c 表示创建元素的虚拟节点方法 _v 表示创建文本的虚拟节点方法\nexport function generate(astRoot) { \n  let children = genChildren(astRoot);\n\n  // 遍历 ast 树，将树拼接成字符串\n  let code = `_c(\"${ astRoot.tag }\", ${\n    astRoot.attrs.length ? genProps(astRoot.attrs) : 'undefined'\n  }${\n    children ? `,${ children }` : '' \n  })`;\n\n  return code;\n}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 匹配标签名\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // 获取标签名\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 匹配开始标签\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配闭合标签\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 > 符号\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配双花括号 {{}}\n\n// 将解析后的结果 通过栈组装成一个 ast 树结构\nfunction createAstElement(tagName, attrs) {\n  return {\n    tag: tagName,\n    type: 1, // 元素类型\n    children: [],\n    parent: null,\n    attrs\n  }\n}\n\nlet root = null; // 树的根节点\nlet stack = []; // 保存每个节点的栈\n\n// 开始标签的处理方法\nfunction start(tagName, attrs) {\n  // console.log('start', tagName, attrs);\n  // 构建 ast 语法树\n  let element = createAstElement(tagName, attrs);\n  // 取出栈中的父节点 做节点关联\n  let parent = stack[stack.length - 1];\n\n  if (!root) {\n    root = element;\n  }\n\n  element.parent = parent; // 记录父节点是谁\n\n  if (parent) {\n    parent.children.push(element);\n  }\n  stack.push(element); // 入栈\n}\n\n// 结束标签的处理方法\nfunction end(tagName) {\n  // console.log('end tag:', tagName);\n  let last = stack.pop(); // 弹出首位\n\n  if (last.tag != tagName) {\n    throw new Error('标签闭合有误');\n  }\n}\n\n// 文本标签的处理方法\nfunction chars(text) {\n  text = text.replace(/\\s/g, '');\n\n  // 取出栈中的父节点 做节点关联\n  let parent = stack[stack.length - 1];\n  \n  if (text) {\n    parent.children.push({\n      type: 3, // 文本标签\n      text\n    });\n  }\n}\n\n// 将模板转成 ast 语法树\nexport function parserHTML(html) {\n  // 解析完毕后 删除标签\n  function advance(len) {\n    html = html.substring(len);\n  }\n\n  // 解析开始标签\n  function parseStartTag(){\n    const start = html.match(startTagOpen);\n    if(start){\n        // 把标签和属性通过正则组装成对象\n        const match = {\n            tagName:start[1],\n            attrs:[]\n        }\n        advance(start[0].length);\n        let attr,end;\n        while(!(end = html.match(startTagClose)) && (attr = html.match(attribute))){\n            advance(attr[0].length);\n            match.attrs.push({ name:attr[1], value:attr[3] });\n        }\n        if(end){\n            advance(end[0].length);\n            return match\n        }\n    }\n}\n\n  // 看看解析的内容是否存在 存在就不停解析\n  while(html) {\n     // 匹配开始或结束标签前面的 <\n    let startOrEnd = html.indexOf('<');\n\n    // 说明当前模板开头可能为开始标签<div>或结束标签</div>\n    if (startOrEnd == 0) {\n      // 尝试匹配开始标签 并把标签转成对象\n      const startTagMatch = parseStartTag(html); \n      \n      // 当前为开始标签\n      if (startTagMatch) {\n        // 处理开始标签转成的对象\n        start(startTagMatch.tagName, startTagMatch.attrs);\n        continue;\n      }\n\n      // 处理结束标签\n      const endTagMatch = html.match(endTag);\n\n      if (endTagMatch) {\n        // 当前为结束标签\n        end(endTagMatch[1]);\n        advance(endTagMatch[0].length);\n      }\n    }\n\n    // 处理文本 走到这里说明当前 html 为 123</div> 的\n    let text;\n\n    if (startOrEnd >= 0) {\n      // 截取文本\n      text = html.substring(0, startOrEnd);\n    }\n\n    if (text) {\n      // 如果文本有值 处理文本并干掉文本\n      chars(text);\n      advance(text.length);\n      continue;\n    }\n  }\n\n  return root;\n}\n","import { generate } from \"./generate\";\nimport { parserHTML } from \"./parser\";\n\n// 模板编译原理\nexport function compileToFunctions(html) {\n  // 1. 将模板转成 ast 语法树\n  let astRoot = parserHTML(html);\n  // 2. 代码生成(根据树，生成 render 方法内部代码)\n  //     比如 _c('div', { id: 'app', a: 1 }, _v(\"hello\"+_s(msg)+\"你好呀\"))\n  let code = generate(astRoot);\n\n  // 3. 把生成的代码包装成 render (敲黑板)\n  //    使用 Function 把字符串变成函数\n  //    使用 with 保证模板上的变量取自 this，后续调用 render.call(vm) 即可\n  let render = new Function(`with(this) { return ${ code } }`); \n  // console.log(render, 'render');\n  return render;\n}","// 观察者收集器\n// 每个属性上需要挂载一个 wacher 收集器 dep (defineReactive 方法顶部闭包方式保存)， 用来收集自己的 wachers，因为一个属性如果在多个组件用，是要多个 watcher\nlet id = 0; // 为了保证唯一性，也给加个序号\n\nclass Dep {\n  constructor() {\n    this.id = id++;\n    this.subs = []; // 存放 watcher\n  }\n\n  depend() {\n    // Dep.target  dep 里要存放这个 watcher，watcher 要存放 dep，多对多的关系\n    if (Dep.target) {\n      // 这一步最终结果是 dep 和 wacher 是互相存\n      Dep.target.addDep(this);\n    }\n  }\n\n  addSub(watcher) {\n    this.subs.push(watcher);\n  }\n  \n  // 通知更新\n  notify() {\n    // 属性一改可能会更新 n 次\n    this.subs.forEach(watcher => watcher.update());\n  }\n}\n\nDep.target = null; // 静态属性\n\nexport function pushTarget(watcher) {\n  Dep.target = watcher;\n}\n\nexport function popTarget() {\n  Dep.target = null;\n}\n\nexport default Dep;","export function isFunction(val) {\n  return typeof val === 'function';\n}\n\nexport function isObject(val) {\n  return typeof val !== 'null' && typeof val === 'object';\n}\n\nexport function isArray(val) {\n  return Object.prototype.toString.call(val) === '[object Array]';\n}\n\nconst callbacks = [];\nlet wating = false; // 防抖\n\n// 依次执行 nextTick 队列中的 callback\nfunction flushCallbacks() {\n  callbacks.forEach(cb => cb());\n  wating = false;\n}\n\n// 降级策略\nfunction timer(cb) {\n  let timerFn = () => {};\n\n  if (Promise) {\n    timerFn = () => {\n      Promise.resolve().then(cb);\n    };\n  } else if (MutationObserver) { // 微任务 监听节点变化的 api\n    let textNode = document.createTextNode(1); // 随便创建个文本节点来监听\n    let observe = new MutationObserver(cb); // 注册个回调\n\n    observe.observe(textNode, { // 监控文本节点变化 characterData 代表文本内容\n      characterData: true\n    });\n\n    timerFn = () => {\n      textNode.textContent = 2;\n    }\n  } else if (setImmediate) { // ie 才认的 api，性能略高于 setTimeout  \n    timerFn = () => {\n      setImmediate(cb);\n    }\n  } else {\n    // 再不支持 只能延时器了\n    timerFn = () => {\n      setTimeout(cb);\n    }\n  }\n  \n  timerFn();\n}\n\n\n// 源码中的调度器会优先调用 nextTick 方法(批量更新就调用)\n// 所以更新 dom 的操作会先入 callbacks 队列\nexport function nextTick(cb) {\n  callbacks.push(cb);\n\n  if (!wating) {\n    // vue3 不考虑兼容，这里直接 Promise.resolve.then(flushCallbacks)\n    // vue2 中考虑兼容性问题，有个降级策略\n    timer(flushCallbacks);\n    wating = true;\n  }\n}","import { nextTick } from \"../utils\";\n\n// wactcher 调度 \nlet queue = [];\nlet has = {}; // 存放 wacher ID，防止相同 watcher 更新多次\nlet pending = false; \n\n// 清空 wacher 队列，每一个 watcher 都是一次更新操作(render + patch)\nfunction flushSchedulerQueue() {\n  console.log(queue);\n  for (let i = 0; i < queue.length; i++) {\n    queue[i].run(); // 更新\n  }\n\n  queue = [];\n  has = {};\n  pending = false;\n}\n\nexport function queueWatcher(watcher) {\n  let id = watcher.id;\n\n  if (has[id] == null) {\n    queue.push(watcher);\n    has[id] = true;\n\n    // 开启一次异步批处理更新(防抖)\n    if (!pending) {\n       console.log('dom 更新 run');\n       \n       // 不能使用延时器，不然我们想拿到更新后的 dom 节点，只能通过 setTimeout 去拿\n       // 而且，我们希望尽早更新，同步代码执行完毕会先执行微任务，而不想等 setTimeout\n      // setTimeout(flushSchedulerQueue, 0);\n\n      nextTick(flushSchedulerQueue);\n      pending = true;\n    }\n  }\n}\n\n","// Dep 上挂载 watcher 的方式，之后会改\nimport { popTarget, pushTarget } from \"./dep\"; \nimport { queueWatcher } from \"./scheduler\";\n\nlet id = 0; // 每 new 一次 watcher，id++\n\n// 观察者类\nclass Watcher {\n  // exprOrFn: 可能是个表达式(计算属性)或者更新的函数(vm._update(vm._render()))\n  constructor(vm, exprOrFn, cb, options) {\n    this.vm = vm;\n    this.exprOrFn = exprOrFn;\n    this.cb = cb;\n    this.options = options;\n    this.id = id++; // watcher 类实例化计数\n    this.deps = [];\n    // 防止一个模板绑定两次相同的值 存两个 dep <span> {{ msg + msg }}}</span>\n    this.depsId = new Set(); \n\n    // render 方法会去 vm 上重新取值，生成虚拟 dom，我们这里把它重命名为 getter\n    this.getter = exprOrFn;\n\n    // 更新函数默认执行一次，首次渲染页面(生成虚拟 dom -> diff -> 真实 dom)\n    this.get();\n  }\n\n  // 重新取值并渲染，取值会调用 defineProperty.get 方法，我们让每个属性都能收集自己的 watcher(多对多的关系)\n  // 每个组件的渲染都会初始化一个 wacher，组件内属性跟 watcher 做绑定\n  // 每个属性可能有多个 watcher(全局的属性 msg 100 个组件使用，就会声明 100 个 wacher 实例跟 msg 做绑定)\n  // 同一个 watcher 实例可能对应 n 多属性，比如 A 组件内有 100 变量，该 watcher 会收集 100 个 dep 供后续使用\n  // 为了收集以上关系，我们声明一个 Dep 类\n  get() {\n    // console.log('dom 渲染');\n    // 注意，这里代码只有要更新页面时(getter 就是更新页面方法)，才会走\n    // 模板内绑定的变量，取值之前这里设置 Dep.target -> wacher\n    // 注意，普通的 vm.msg 取值不会走该方法，也就是普通的读取变量 Dep.target -> null\n    pushTarget(this); \n    // 只有取值的时候，把当前 watcher 收集到当前属性的收集器 Dep 上，并渲染页面\n    // 也就是说，当前变量在模板中使用到了，才会去收集 watcher (没用到不取)\n    this.getter();\n    // 取值之后 立马清空挂载的 wacher 实例\n    popTarget(); \n  } \n\n  // 双向收集\n  addDep(dep) {\n    let id = dep.id;\n\n    // 如果没存过这个 dep， 再存\n    if (!this.depsId.has(id)) {\n      this.depsId.add(id);\n      this.deps.push(dep);\n      dep.addSub(this);\n    }\n  }\n\n  // 存起来要更新的操作，交给调度器\n  update() {\n    // 缓存 wacher，多次调用先缓存，等会儿去重一起更新。\n    // 这就是为什么 vue 的数据更新是异步的\n    queueWatcher(this);\n  }\n\n  // 调度器更新实际调用的方法\n  run() {\n    // 渲染操作的更新方法，后续还有其他更新\n    this.get();\n  }\n}\n\nexport default Watcher;","/**\n * @description dom diff & 生成虚拟 dom 方法\n * @param { Element | Object } el 根 dom 节点\n * @param { Object } vnode 虚拟 dom 对象 \n */\nexport function patch(curElm, vnode) {\n  // 把 vnode 生成真实 dom，挂载节点整个替换\n  if (curElm.nodeType == 1) {\n    const parentElm = curElm.parentNode; // 找到挂载节点的父节点\n    const newElm = createElm(vnode); // 根据虚拟节点 创建真实节点\n\n    parentElm.insertBefore(newElm, curElm.nextSibling); // 放在挂载节点的下一个元素\n    parentElm.removeChild(curElm); // 删除掉挂载节点\n\n    return newElm; // 新的根节点返还 重新挂载到 vm.$el 上\n  }\n}\n\n// 创建真实 dom，并插入到页面(父节点)\nfunction createElm(vnode) {\n  let { tag, data, children, text, vm } = vnode;\n\n  if (typeof tag === 'string') { \n    // 元素节点\n    // 把当前真实节点挂载到虚拟节点的 elm 属性上，方便下层使用\n    vnode.elm = document.createElement(tag); \n\n    // 处理子节点(树的深度遍历)\n    children.forEach(child => {\n      // 插入到父真实节点上\n      // console.log(child);\n      vnode.elm.appendChild(createElm(child));\n    });\n  } else {\n    // 文本节点\n    // console.log('------text-------', text, vnode);\n    vnode.elm = document.createTextNode(text);\n  }\n\n  return vnode.elm;\n}","import Watcher from \"./observer/watcher\";\nimport { nextTick } from \"./utils\";\nimport { patch } from \"./vdom/patch\";\n\nexport function lifecycleMixin(Vue) {\n  // 生成真实 dom 的方法\n  Vue.prototype._update = function(vdom) {\n    const vm = this;\n    // console.log(vm.$el, '_updata', vdom);\n    // 既有初始化，又有更新\n\n    // 老节点被干掉了 使用新节点\n    vm.$el = patch(vm.$el, vdom); // diff 来啦\n  }\n\n  // nextTick 方法\n  Vue.prototype.$nextTick = nextTick;\n}\n\n// 后续每个组件渲染的时候都会有一个 watcher\nexport function mountComponent(vm, el) {\n  // 更新函数 数据变化后 会再次调用此函数\n  let updataComponent = () => {\n    // 调用 render 函数，生成虚拟 dom，用虚拟 dom 生成真实 dom\n    vm._update(vm._render());\n  }\n\n  // 注掉原有更新逻辑\n  // updataComponent();\n\n  // 传入 true 标识着他是一个渲染 watcher，后续还会有其他 watcher，这里做个标识\n  new Watcher(vm, updataComponent, () => {\n    console.log('更新视图啦');\n  }, true); \n}","// 这里不对数组原型做操作，只针对 data 中的数组，增加了一层方法拦截\n let oldArrayPrototype = Array.prototype; \n// 挂载老的原型对象到 arrayMethod 上，arrayMethod.__proto__ 能拿到 oldArrayPrototype\nlet arrayMethod = Object.create(oldArrayPrototype); \n\n// 只有这七个方法修改了原数组 所以要重写\nlet methods = ['push', 'pop', 'splice', 'shift', 'unshift', 'reverse', 'sort'];\n\nmethods.forEach(method => {\n  // 先找自己身上，找不到去原型对象上找「arrayMethod 的原型对象是 oldArrayPrototype」\n  // 比如 push 方法可以传多个参数，所以这里通过扩展运算符拿到参数列表\n  arrayMethod[method] = function(...args) {\n    // 调用原有数组方法\n    oldArrayPrototype[method].call(this, ...args);\n\n    let inserted = null; // 新插入的元素\n\n    // 对新增的元素进行重新劫持，新增数组元素的方法只有 splice、push、unshift\n    switch(method) {\n      case 'splice':\n        // splice 第二个参数后，就是新增的元素\n        inserted = args.slice(2);\n      case 'push':\n      case 'unshift':\n        // push 和 unshift 传入的元素即为新增元素\n        inserted = args;\n        break;\n    }\n\n    // 遍历 inserted，需要劫持的增加数据劫持，但是数据劫持的方法在 Observer 类上\n    // 我们取巧的把 Observer 类的实例挂载到当前操作的数组上 叫 __ob__，具体见 Observer 中实现\n    let ob = this.__ob__;\n\n    // 接着劫持 本身是个数组\n    if (inserted) ob.observeArray(inserted);\n  }\n});\n\nexport default arrayMethod;","import { isArray, isObject } from \"../utils\";\nimport arrayMethod from \"./array\"; // 数组结束(方法重写)\nimport Dep from \"./dep\";\n\n// 观察者类\nclass Observer {\n  constructor(val) {\n    // 给对象和数组添加一个自定义属性，用于数组新增元素时的再次劫持\n    // 不过切记 __ob__ 属性不能被枚举，不然如果 val 是个对象的话，就会把 __ob__ 也劫持\n    // 这也是我们看到所有的 Vue 变量都有 __ob__ 属性的原因\n    Object.defineProperty(val, '__ob__', {\n      value: this,\n      enumerable: false\n    });\n\n    if (isArray(val)) { // 我希望数组的变化可以触发视图更新\n      // 如果是 val 数组，修改原型方法 这里就不考虑兼容 ie 了\n      // 这里只针对 data 中的数组，没有重写 Array.prototype 上的方法\n      val.__proto__ = arrayMethod;\n      this.observeArray(val);\n    } else {\n      this.walk(val); // 遍历属性进行劫持\n    }\n  }\n\n  // 递归遍历数组，对数组内部的对象再次重写 比如 [{}]  [[]]\n  // 需要注意的是: 数组套对象的话，修改对象属性，也会触发更新，比如：\n  // vm.arr[0].a = 100 ----> 触发更新\n  // vm.arr[0] = 100   ----> 不会触发更新\n  observeArray(val) {\n    // 调用 observe 方法，数组内元素如果不是对象，则不会劫持\n    val.forEach(itm => observe(itm));\n  }\n\n  // 遍历对象\n  walk(data) {\n    Object.keys(data).forEach(key => {\n      // 使用 defineProperty 重新定义\n      defineReactive(data, key, data[key]);\n    })\n  }\n}\n\n// vue2 慢的一个原因\n// 这里引出几条 vue2 的性能优化原则\n//   @1 不要把所有的数据都放在 data 中，闭包过多会损耗性能\n//   @2 尽量扁平化数据，不要嵌套多次，递归影响性能\n//   @3 不要频繁获取数据，会触发 get 方法，走 get 方法中的全部逻辑\n//   @4 如果数据某属性不需要响应式，可以使用 Object.freeze 冻结属性「源码里会跳过 defineReactive」\nfunction defineReactive(obj, key, value) {\n  observe(value); // 递归进行劫持\n  let dep = new Dep(); // 给当前变量声明一个 Dep(闭包中保存)，并收集 watcher\n\n  Object.defineProperty(obj, key, {\n    get() {\n      // 这里就形成一个闭包，每次执行 defineReactive 上下文都不会被释放\n      // 所以这就是 vue2 的性能瓶颈\n      console.log(key, 'get 取值啦');\n      if (Dep.target) {\n        // 说明是解析模板内变量 也就是 render 执行时候用到的 vm 中变量取值\n        // console.log('渲染模板内属性', key);\n        // 模板内变量的 Dep 里收集 watcher\n        dep.depend(Dep.target);\n      }\n      \n      return value;\n    },\n    set(newValue) {\n      if (newValue !== value) {\n        // console.log('触发set方法');\n        // 设置新值重新劫持 \n        observe(newValue); \n        value = newValue;\n        // 每个属性的闭包中的 dep 实例\n        dep.notify(); // 告诉当前属性存放的 watcher 执行\n      }\n    }\n  });\n}\n\nexport function observe(data) {\n  // 如果不是对象，直接返回「非对象类型不进行递归劫持」\n  if (!isObject(data)) return;\n\n  // 如果被劫持过，就不再进行劫持了\n  if (data.__ob__) return;\n\n  // 如果一个数据被劫持过了，就不要重复劫持了，这里用类来实现\n  // 劫持过的对象 把类的实例挂在到 data.__ob__\n  return new Observer(data);\n}","import { observe } from \"./observer\";\nimport { isFunction } from \"./utils\";\n\n// 统一的数据的初始化分发\nexport function initState(vm) {\n  const options = vm.$options;\n\n  if (options.data) {\n    initData(vm);\n  }\n}\n\n// 代理 -> 使用 vm.info 取到 vm.data.info「劫持过的 info」\nfunction proxyFn(vm, key, source) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(newVal) {\n      vm[source][key] = newVal;\n    }\n  });\n}\n\nfunction initData(vm) {\n  // 数据的初始化\n\n  // 注意 data 可能是个对象 也可能是个函数\n  //   + 对象：根实例\n  //   + 函数：页面组件互相之间的数据隔离\n  let data = vm.$options.data;\n\n  // 注意修正 this，防止 data 函数执行 this 指向 window\n  // 把 data 赋值给 vm 实例一个变量上，这里取名 _data，作为实例的属性数据源\n  data = vm._data = isFunction(data) ? data.call(vm) : data;\n\n  // 数据劫持\n  observe(data);\n\n  // 取 data.info => vm._data.info 做了一层代理获取到劫持后的 info\n  // 这也是 vue 中我们可以用 this 访问和修改 data 中数据的原因\n  for (let key in data) {\n    proxyFn(vm, key, '_data');\n  }\n}","\nimport { compileToFunctions } from \"./compiler\";\nimport { mountComponent } from \"./lifecycle\";\nimport { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  // 后续组件化开发的时候，Vue.extend 可以创造一个子组件，子组件也可以调用 _init 方法\n  Vue.prototype._init = function(options) {\n    const vm = this;\n    \n    // 注意调用的时候是 实例._init, 所以这里的 this 指的是实例本身 \n    // 把用户的配置放到实例上, 这样在其他方法中都可以共享 options 了\n    vm.$options = options;\n\n    // 因为数据的来源有很多种，比如 data、props、computed 等，我们要做一个统一的数据的初始化『数据劫持』\n    initState(vm);\n\n    if (vm.$options.el) {\n      // 要将数据挂载到页面上『模板解析』\n      // console.log('页面要挂载');\n\n      // 现在数据已经被劫持了，数据变化需要更新视图(diff 算法更新需要更新的部分)\n      // 在 vue2 中，使用的是更符合前端思维的 template 而不是更灵活的 JSX\n      // vue3 template 写起来性能会高一些，内部做了很多优化，所以在 vue3 里面尽量不要使用 jsx\n\n      // 挂载到的 DOM 节点，其实最终用的都是 $mount 方法\n      // 处理 new Vue({ el })  写法\n      vm.$mount(vm.$options.el);\n    } \n  }\n\n  // 挂载节点的方法(如果 options 中不传 el 的话)\n  // 兼容 new Vue({}).$mount(el) 这种写法\n  Vue.prototype.$mount = function(el) {\n    const vm = this;\n    const opts = vm.$options;\n\n    el = document.querySelector(el); // 获取真实节点\n    vm.$el = el; // 真实元素挂载到实例上\n\n    if (!opts.render) {\n      // 模板编译\n      let template = opts.template;\n\n      if (!template && el) {\n        // outerHTML 取得是该元素和其所有子元素序列化后的字符串标签\n        template = el.outerHTML;\n      }\n\n      // compileToFunctions 为模板编译的方法，模板 -> js 对象 -> ast -> render code -> 生成 render 函数\n      let render = compileToFunctions(template); // el 节点本身\n\n      opts.render = render;\n    }\n\n    // opts.render 就是渲染函数\n    // console.warn(opts.render, 'opts.render');\n\n    // 开始组件挂载流程(生命周期方法)，也就是模板解析(变量渲染到dom上)\n    mountComponent(vm, el);\n  }\n}","// 创建虚拟 dom 节点 也就是 render 方法中  _c\nexport function createElement(vm, tag, data = {}, children) {\n  // console.log('createElement 方法', tag, data, children, vm);\n  return vnode(vm, tag, data, data.key, children, undefined); // key 挂在了虚拟dom上哦\n}\n\n // 创建虚拟文本节点 也就是 render 方法中  _v\nexport function createTextElement(vm, text) {\n  // console.log('createTextElement 方法', text, vm);\n  return vnode(vm, undefined, undefined, undefined, undefined, text);\n}\n\n// 虚拟dom (比 ast 数更自由，随意组合属性，哪怕不合法的属性)\nfunction vnode(vm, tag, data, key, children, text) {\n  return {\n    vm, \n    tag, \n    data, \n    key, \n    children,\n    text\n  }\n}","import { createElement, createTextElement } from \"./vdom\";\n\nexport function renderMixin(Vue) {\n  // 创建 render 函数需要的三个方法\n  Vue.prototype._c = function(tagName, data, ...children) { // createElement\n    const vm = this;\n\n    return createElement(vm, tagName, data, children);\n  }\n\n  Vue.prototype._v = function(text) { // createTextElement\n    const vm = this;\n\n    return createTextElement(vm, text);\n  }\n\n  // 转字符串\n  Vue.prototype._s = function(val) {\n    if (typeof val === 'object') return JSON.stringify(val);\n    return val;\n  }\n\n  // 把 vm.$options 上的 render 方法 挂载到原型链\n  Vue.prototype._render = function() {\n    const vm = this;\n\n    // 就是我们通过 ast 生成的 render 方法(或者原本就传了 render 方法)\n    let render = vm.$options.render;\n    \n    let vnode = render.call(vm);\n    \n    return vnode;\n  }\n}","import { initMixin } from './initMixin'; \nimport { lifecycleMixin } from './lifecycle';\nimport { renderMixin } from './render';\n\nfunction Vue(options) {\n  this._init(options);\n}\n\n// 在 Vue 原型链上扩展方法 \ninitMixin(Vue);\n\n// 原型链挂载 _render -> 生成虚拟 dom 方法\nrenderMixin(Vue);\n\n// 原型链挂载 _update -> 生成真实 dom 方法\nlifecycleMixin(Vue);\n\nexport default Vue;"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","styleObj","value","replace","arguments","JSON","stringify","slice","gen","node","type","generate","text","test","tokens","match","lastIdx","lastIndex","exec","startIdx","index","push","trim","join","genChildren","children","map","c","astRoot","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","createAstElement","tagName","parent","root","stack","start","element","end","last","pop","Error","chars","parserHTML","html","advance","len","substring","parseStartTag","startOrEnd","indexOf","startTagMatch","endTagMatch","compileToFunctions","render","Function","id","Dep","constructor","subs","depend","target","addDep","addSub","watcher","notify","forEach","update","pushTarget","popTarget","isFunction","val","isObject","isArray","Object","prototype","toString","call","callbacks","wating","flushCallbacks","cb","timer","timerFn","Promise","resolve","then","MutationObserver","textNode","document","createTextNode","observe","characterData","textContent","setImmediate","setTimeout","nextTick","queue","has","pending","flushSchedulerQueue","console","log","run","queueWatcher","Watcher","vm","exprOrFn","options","deps","depsId","Set","getter","get","dep","add","patch","curElm","vnode","nodeType","parentElm","parentNode","newElm","createElm","insertBefore","nextSibling","removeChild","data","elm","createElement","child","appendChild","lifecycleMixin","Vue","_update","vdom","$el","$nextTick","mountComponent","el","updataComponent","_render","oldArrayPrototype","Array","arrayMethod","create","methods","method","args","inserted","ob","__ob__","observeArray","Observer","defineProperty","enumerable","__proto__","walk","itm","keys","key","defineReactive","obj","set","newValue","initState","$options","initData","proxyFn","source","newVal","_data","initMixin","_init","$mount","opts","querySelector","template","outerHTML","undefined","createTextElement","renderMixin","_c","_v","_s"],"mappings":"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"}